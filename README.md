# laser-embebed

[ProjectConverter](https://github.com/phodina/ProjectConverter) is used to convert

This project is an example of conversion from [Keil Embedded Development Tools for Arm](https://www.keil.com/) to [CMake](https://cmake.org/).

## Usage

### Preparation

- CMake
- [GNU Arm Embedded Toolchain](https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads)
- [MSYS2](https://www.msys2.org/) (If you're running on Windows)
- [stlink-org/stlink](https://github.com/stlink-org/stlink/releases/tag/v1.7.0) (add it to you `PATH`)

### Modify `CMakeLists.txt`

#### Windows

modify the `tools` varible to your location of GNU Arm Embeded Toolchain

```cmake
set(tools "C:/Program Files (x86)/GNU Arm Embedded Toolchain/9 2020-q2-update")
```

and use (you should choose [MSYS Makefiles](https://cmake.org/cmake/help/latest/generator/MSYS%20Makefiles.html) or [MinGW Makefiles](https://cmake.org/cmake/help/latest/generator/MinGW%20Makefiles.html) as your generator)

```powershell
cmake . -G "MSYS Makefiles"
```

to generate your makefile.

#### Linux

Just

```bash
cmake .
```

directly, you don't have to configure anything else (I guess)

### Configuration of Visual Studio Code

modify your `c_cpp_properties.json`. You have to configure C/C++ extension properly to make IntelliSense work correctly.

```jsonc
{
    "configurations": [
        {
            "name": "STM32F10X", // Just name it
            "includePath": [
                "${workspaceFolder}/**", // include all the files in workspace
                // This is where you install your GNU Arm Embedded Toolchain. 
                "C:\\Program Files (x86)\\GNU Arm Embedded Toolchain\\9 2020-q2-update\\arm-none-eabi\\include\\**"  
            ],
            "defines": [
                "_DEBUG",
                "UNICODE",
                "_UNICODE",
                "STM32F10X_HD", // This is additional defines
                "USE_STDPERIPH_DRIVER" // This is additional defines
            ],
            // You MUST set your compilerPath to GNU Arm Embedded Toolchain or it will complain
            "compilerPath": "C:\\Program Files (x86)\\GNU Arm Embedded Toolchain\\9 2020-q2-update\\bin\\arm-none-eabi-gcc.exe",
            "cStandard": "c17",
            "cppStandard": "c++17",
            "intelliSenseMode": "${default}", // I have no idea what this means so just default
            "compileCommands": "${workspaceFolder}/build/compile_commands.json",
            "configurationProvider": "ms-vscode.cmake-tools" // I have no idea what this means. Maybe it's about cmake
        }
    ],
    "version": 4
}
```

See [µVision User's Guide Preprocessor Symbols](https://www.keil.com/support/man/docs/uv4/uv4_dg_adscc.htm)
### Use Keil as Command Line Tools

See [µVision User's Guide: Command Line](https://www.keil.com/support/man/docs/uv4/uv4_commandline.htm). Also check this gist: [Makefile for building keil projects](https://gist.github.com/samvasko/10017340).

## Useful Links

### CMake

- [visual c++ - Automatically add all files in a folder to a target using CMake? - Stack Overflow](https://stackoverflow.com/questions/3201154/automatically-add-all-files-in-a-folder-to-a-target-using-cmake)

### Project Generator

- [project-generator/project_generator: Project generators for various embedded tools (IDE). IAR, uVision, Makefile, CoIDE, Eclipse and many more in the roadmap!](https://github.com/project-generator/project_generator)
- [makefile generated by projectgenerator](https://gist.github.com/crosstyan/058c6be881ba1f51912a58fa146f232b)

### How the conversion works

- [Linux下实现飞控开发：使用CMake构建STM32工程_王伟韵-CSDN博客_cmake stm32](https://blog.csdn.net/loveuav/article/details/101361408)
- [根据Keil项目文件修改成tiny的Makefile_YearIllusion的博客-CSDN博客](https://blog.csdn.net/YearIllusion/article/details/102415237?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-4.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-4.control)
- [使用makefile替换Keil进行编译_zfx277266940的专栏-CSDN博客](https://blog.csdn.net/zfx277266940/article/details/39269045)
- [使用GCC编译STM32工程 | 码农家园](https://www.codenong.com/cs106677907/)
